\documentclass[12pt,journal,compsoc]{IEEEtran}
\providecommand{\PSforPDF}[1]{#1}
\newcommand\MYhyperrefoptions{bookmarks=true,bookmarksnumbered=true,
pdfpagemode={UseOutlines},plainpages=false,pdfpagelabels=true,
colorlinks=true,linkcolor={black},citecolor={black},pagecolor={black},
urlcolor={black},
pdftitle={DCPT tweaks},
pdfsubject={Prefetcher},
pdfauthor={Leif Tore Rusten, Stian Fredrikstad, Vegar K\aa sli},
pdfkeywords={dcpt,rpt,prefetcher}}
\hyphenation{op-tical net-works semi-conduc-tor}


\begin{document}
\title{DCPT tweaks \\ Working title}
\author{Leif Tore Rusten,
        Stian Fredrikstad,
        and Vegar K\aa sli}

\markboth{DCPT tweaks}%
{DCPT tweaks}

\IEEEcompsoctitleabstractindextext{%
\begin{abstract}
%\boldmath
This paper will explain some tweaks to the DCPT algorithm and compare speedups to the "original" DCPT
\end{abstract}
% IEEEtran.cls defaults to using nonbold math in the Abstract.
% This preserves the distinction between vectors and scalars. However,
% if the journal you are submitting to favors bold math in the abstract,
% then you can use LaTeX's standard command \boldmath at the very start
% of the abstract to achieve this. Many IEEE journals frown on math
% in the abstract anyway. In particular, the Computer Society does
% not want either math or citations to appear in the abstract.

% Note that keywords are not normally used for peerreview papers.
\begin{IEEEkeywords}
DCPT, RPT, prefetcher
\end{IEEEkeywords}}


% make the title area
\maketitle


% To allow for easy dual compilation without having to reenter the
% abstract/keywords data, the \IEEEcompsoctitleabstractindextext text will
% not be used in maketitle, but will appear (i.e., to be "transported")
% here as \IEEEdisplaynotcompsoctitleabstractindextext when compsoc mode
% is not selected <OR> if conference mode is selected - because compsoc
% conference papers position the abstract like regular (non-compsoc)
% papers do!
\IEEEdisplaynotcompsoctitleabstractindextext
% \IEEEdisplaynotcompsoctitleabstractindextext has no effect when using
% compsoc under a non-conference mode.


% For peer review papers, you can put extra information on the cover
% page as needed:
% \ifCLASSOPTIONpeerreview
% \begin{center} \bfseries EDICS Category: 3-BBND \end{center}
% \fi
%
% For peerreview papers, this IEEEtran command inserts a page break and
% creates the second title. It will be ignored for other modes.
\IEEEpeerreviewmaketitle



\section{Introduction}

\section{Methodology}
%This section should describe how we attempt to solve our problems.

The methodology used in the beginning was to start with a sequential
prefetcher and briefly progress through prior art, i.e. an RPT implementation
and finally a DCPT implementation. During development the performance was
measured by running a M5-simulator testbench framework and the obtained test
results where evaluated against previous versions' results for
empirically determining the usefulness of the modification.

The prefetcher development has been driven by ideas from the group and it
has been a low barrier for implementing ideas. The ideas proposed have been
thought to be improvements mostly because of personal or group reflection over
the current prefetching mechanism and the memory hierarchy. Testing of
many different modifications and following performance evaluations have been
done rapidly.

So far the development can be seen as searching somewhat blindly for a good
solution. The proposed modifications have often been based on an insight
about the currently implemented prefetcher's (seq, RPT or DCPT) functionality.
Other modifications are mere tweaks of parameters for the different prefetcher
strategies for fine-tuning the performance metrics. Since the main focus of
our research is on the DCPT prefetcher and the development methodology
outlined above (basicly the group using its creativity) will probably only
give a noteworthy performance increase by chance. And even though such
modifications could have been based on a justified/rational idea spurred by
creativity, it would have been better if they where based on measurements and
novel memory access patterns derived from an analytical method.

This means that a shift of methodology probably is required to make truly
interesting discoveries academically and make it more likely to find and
exploit prefetching opportunities. For the remaining work the use of valgrind
and the inspection of which code snippets give cache misses and trying to
analyse these to find potential underlying factors/mechanisms for these
will become a more important tool as we run out of good a priori
insights/ideas.

\section{"The Scheme"}
% A short description of what we will present --- what we have done.

\subsection{Sequential (seq)}
The framework contained a sequential prefetcher as a starting point.
Modifications related to the prefetch distance and degree where tried.
% An example?
Also the criteria for starting prefetching sequential where tried modified.
% Or was it? I seem to think so at least, find the change and document it.

% Also add the result and try to explain them.

Created a trivial test program (accumulate.c) that accessed a large sequential
chunk of memory in a tight loop body to assess the optimal prefetch distance
for this type of code structure. This estimates the best possible performance
gain for sequential prefetching for shortest possible loop body and the
measured optimum acts therefore as an upper bound for how many elements should
be present in cache to overlap the time it takes to prefetch enough new
elements to refill the consumption of elements from cache.

\subsection{Reference Prediction Table (RPT)}

\subsection{Delta Correlating Prediction Table}
The algorithm for DCPT (Delta Correlating Prediction Table) is based on the pseudo code from \cite{dcptpaper}.
The implementation is very near RPT, but the difference is that it looks for a pattern instead of one stride.
When the it gets a request, it saves the (PC) program counter, and the stride in a table connected to each PC. When it has more than two elements in the list with strides, it starts looking for patterns.
If it finds a pattern in the list, it saves all the adresses that possibly should be prefetched in another list with candidates for prefetch.
Then it runs through the list and checks if the adresses is not in the cache, in the mshr or that the adress is out of memory. If all the requirements are met, it issues a prefetch for it.

The first implementation done, did something wrong according to \cite{dcptpaper}, it did not use the deltas like they should. It prefetched all adresses that came after the matching sequence, but all the adresses used the same adress as base, so if there was a array of deltas like 1,2,3,4,1,2,5,1,2 and the last memory adress was 10, it would prefetch: 10+3, 10+4, 10+1, 10+2, 10+5.

The second implemenation should do it right according to \cite{dcptpaper}, it would with the same sequence as the last example prefetch: 10+5, 15+1, 16+2, 18+1, 19+2, 21+3, 24+4.

Attempts to tweak this implementation:
- Make a copy of the queue to keep track of which adresses that still aren't fetched, to avoid "double fetching".
- Make a lru which prevents the prefetcher from throwing out recently used history from the list.
- Adjustments to the size of the list, and size of the delta list

\section{Results}
\subsection{Delta Correlation Prediction Table}
The first implementation of DCPT was not right according to the pseudocode in \cite{dcptpaper}, but it accomplish a 8.6\% speedup with a table of 100 entries and 10 delta per entry.
The attempts to tweak this with other values have not been successful, but it gives around 8\% speedup.
Attempts to add a check to issue less prefetches does also lead to less speedup.

The next implementation, which should be right according to the pseudocode in \cite{dcptpaper} did not do as well, a maximum of 7.3\% speedup with the same specification as the first implementation was accomplished.
\section{Conclusion}
\appendices
\section{}
%Appendix one text goes here.

% you can choose not to have a title for an appendix
% if you want by leaving the argument blank
%\section{}
%Appendix two text goes here.


% use section* for acknowledgement
\ifCLASSOPTIONcompsoc
  % The Computer Society usually uses the plural form
%  \section*{Acknowledgments}
\else
  % regular IEEE prefers the singular form
%  \section*{Acknowledgment}
\fi


% Can use something like this to put references on a page
% by themselves when using endfloat and the captionsoff option.
\ifCLASSOPTIONcaptionsoff
  \newpage
\fi



\begin{thebibliography}{1}

\bibitem{dcptpaper}
M.~Grann\ae s, M.~Jahre and L.~Natvig, \emph{Storage Efficient Hardware Prefetching using Delta Correlating Prediction Tables}, 2009.

\end{thebibliography}



% that's all folks
\end{document}


